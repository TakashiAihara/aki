# Feature Specification: 家庭用在庫管理システム (Household Inventory Management)

**Feature Branch**: `001-household-inventory`
**Created**: 2026-01-01
**Status**: Draft
**Input**: User description: "まずベーシックな家庭用在庫管理アプリを作りたい。今後それをもとに献立だったり消費期限間近のもののお知らせだったりなどをしつつ栄養管理をしていけるようにしたい。この在庫管理アプリはiOSとAndroidとCLIとWeb管理画面から触れるものにしてほしい。"

## Clarifications

### Session 2026-01-01

- Q: When inventory quantity reaches zero, how should the system handle the item? → A: Keep the item in inventory with quantity 0, marked as "depleted"
- Q: When a user adds an item with the same name as an existing item, how should the system handle it? → A: Merge only if expiration date matches, otherwise create separate
- Q: When an item's expiration date has passed, how should it be displayed in the inventory list? → A: Show in main list with visual warning (red text/icon, "expired" badge)
- Q: Should the system support multiple users sharing a single household inventory? → A: Support both modes (user can choose individual or shared household)
- Q: When multiple devices edit the same item offline, how should conflicts be resolved? → A: Last write wins - most recent timestamp overwrites (notify user of overwrite)

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 在庫アイテムの追加と閲覧 (Priority: P1)

家庭のユーザーが食材や日用品を購入したときに、在庫として登録し、後でその在庫リストを確認できる。

**Why this priority**: 在庫管理アプリの最も基本的な機能であり、これがなければアプリとして成立しない。ユーザーは購入した商品を記録し、何を持っているかを把握できる必要がある。

**Independent Test**: ユーザーがアイテムを追加し、在庫リストに表示されることを確認できる。任意のプラットフォーム(iOS/Android/Web/CLI)から実行可能。

**Acceptance Scenarios**:

1. **Given** ユーザーがログインしている, **When** 新しい食材(例: りんご)を名前、数量、消費期限を指定して追加する, **Then** 在庫リストにそのアイテムが表示される
2. **Given** 複数のアイテムが在庫に登録されている, **When** ユーザーが在庫リスト画面を開く, **Then** すべての登録済みアイテムが一覧表示される
3. **Given** ユーザーが在庫リストを閲覧している, **When** 各アイテムの詳細を確認する, **Then** 名前、数量、消費期限、登録日時が表示される

---

### User Story 2 - 在庫アイテムの更新と削除 (Priority: P2)

ユーザーが在庫アイテムを消費したり、数量を変更したり、不要になったアイテムを削除できる。

**Why this priority**: 在庫は常に変動するため、追加だけでなく更新・削除機能も必要。これにより在庫リストを常に最新の状態に保つことができる。

**Independent Test**: ユーザーが既存のアイテムの数量を変更したり、削除したりして、その変更が在庫リストに反映されることを確認できる。

**Acceptance Scenarios**:

1. **Given** 在庫に「りんご 5個」が登録されている, **When** ユーザーが数量を3個に変更する, **Then** 在庫リストには「りんご 3個」と表示される
2. **Given** 在庫にアイテムが登録されている, **When** ユーザーがそのアイテムを削除する, **Then** そのアイテムは在庫リストから削除され表示されなくなる
3. **Given** 在庫にアイテムが登録されている, **When** ユーザーが消費期限を更新する, **Then** 新しい消費期限が在庫リストに反映される

---

### User Story 3 - 在庫の検索とフィルタリング (Priority: P3)

ユーザーが多数の在庫アイテムの中から、特定のアイテムを名前で検索したり、カテゴリや消費期限でフィルタリングできる。

**Why this priority**: 在庫が増えると一覧から目的のアイテムを探すのが困難になる。検索・フィルタ機能により、目的のアイテムを素早く見つけられる。

**Independent Test**: ユーザーが検索キーワードを入力したり、フィルタ条件を設定して、条件に合致するアイテムのみが表示されることを確認できる。

**Acceptance Scenarios**:

1. **Given** 在庫に複数のアイテムが登録されている, **When** ユーザーが「りんご」で検索する, **Then** 名前に「りんご」を含むアイテムのみが表示される
2. **Given** 在庫にさまざまな消費期限のアイテムがある, **When** ユーザーが「消費期限が1週間以内」でフィルタリングする, **Then** 該当するアイテムのみが表示される
3. **Given** 在庫にカテゴリ分けされたアイテムがある, **When** ユーザーが「野菜」カテゴリでフィルタリングする, **Then** 野菜カテゴリのアイテムのみが表示される

---

### User Story 4 - マルチプラットフォーム対応 (Priority: P4)

ユーザーがiOS、Android、Web、CLIの任意のプラットフォームから在庫管理機能にアクセスし、同じデータを共有できる。

**Why this priority**: ユーザーは外出先ではモバイル、自宅ではWebやCLI、という使い分けをしたい。マルチプラットフォーム対応により、どこからでも同じ在庫情報にアクセスできる。

**Independent Test**: ユーザーがiOSアプリでアイテムを追加し、Webブラウザで同じアイテムが表示されることを確認できる。

**Acceptance Scenarios**:

1. **Given** ユーザーがiOSアプリで在庫アイテムを追加した, **When** 同じユーザーがWebブラウザでログインする, **Then** iOSで追加したアイテムがWeb上でも表示される
2. **Given** ユーザーがAndroidアプリで在庫を更新した, **When** CLIから在庫リストを確認する, **Then** Androidで更新した内容がCLIでも反映されている
3. **Given** ユーザーがWebから在庫を削除した, **When** iOSアプリで在庫リストを確認する, **Then** Webで削除したアイテムはiOSアプリでも表示されない

---

### Edge Cases

- 在庫数量が0になったとき、アイテムは削除されず「使い切り」状態として残る。ユーザーは購入履歴を確認でき、再購入時に参照できる
- 同じ名前のアイテムを登録する場合、消費期限が既存アイテムと一致すれば数量を合算し、異なれば別アイテムとして作成する(例: 1/5購入のりんごと1/10購入のりんごは別々に管理)
- 消費期限が過去の日付のアイテムは、メインの在庫リストに表示され続けるが、視覚的な警告(赤色テキスト/アイコン、「期限切れ」バッジ)が表示される
- ユーザーは個人用在庫モードまたは世帯共有モードを選択できる。世帯共有モードでは複数ユーザーが同じ在庫を閲覧・編集可能
- ネットワークがオフラインのとき、モバイルアプリは操作をローカルに保存し、オンライン復帰時に自動同期する
- 複数デバイスから同時に同じアイテムを編集した場合、最新のタイムスタンプを持つ変更が優先される(Last Write Wins)。上書きされたユーザーには通知が表示される
- 非常に大量のアイテム(1000件以上)が登録されたときのパフォーマンス
- 画像がない場合のデフォルト表示
- 無効な消費期限(過去すぎる日付や未来すぎる日付)が入力されたときのバリデーション

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムはユーザーが在庫アイテム(名前、数量、消費期限、カテゴリ、保管場所、メモ)を登録できなければならない
- **FR-002**: システムは登録された在庫アイテムを一覧表示できなければならない
- **FR-003**: システムはユーザーが在庫アイテムの情報(数量、消費期限など)を更新できなければならない
- **FR-004**: システムはユーザーが在庫アイテムを削除できなければならない
- **FR-005**: システムは在庫アイテムに画像を添付できなければならない(任意)
- **FR-006**: システムはユーザーがアイテム名でキーワード検索できなければならない
- **FR-007**: システムはユーザーがカテゴリ、消費期限、保管場所でフィルタリングできなければならない
- **FR-008**: システムは在庫データをユーザーアカウントごとに分離して管理しなければならない
- **FR-009**: システムはiOS、Android、Web、CLIの各プラットフォームから同じ在庫データにアクセスできなければならない
- **FR-010**: システムはユーザー認証機能を提供し、ユーザーごとの在庫を保護しなければならない
- **FR-011**: システムは在庫アイテムの登録日時と最終更新日時を記録しなければならない
- **FR-012**: システムは在庫アイテムをカテゴリごとに分類して表示できなければならない
- **FR-013**: システムは消費期限が近いアイテムを識別できなければならない(基準: 3日以内)
- **FR-014**: システムはオフライン時の操作を保存し、オンライン復帰時に同期しなければならない
- **FR-015**: システムは複数デバイス間でのデータ同期を提供しなければならない
- **FR-016**: システムは数量が0のアイテムを「使い切り」状態として保持し、再購入の参照用として利用できなければならない
- **FR-017**: システムは同名アイテム登録時に、消費期限が既存アイテムと一致する場合は数量を合算し、異なる場合は別アイテムとして作成しなければならない
- **FR-018**: システムは消費期限が過去のアイテムを、視覚的な警告(赤色表示、「期限切れ」バッジなど)付きでメインリストに表示しなければならない
- **FR-019**: システムはユーザーが個人用在庫モードまたは世帯共有モードを選択できなければならない
- **FR-020**: 世帯共有モードでは、複数のユーザーが同じ在庫を閲覧・編集できなければならない
- **FR-021**: システムは世帯へのユーザー招待機能を提供しなければならない(招待コードまたはメールアドレスベース)
- **FR-022**: 世帯共有モードでは、誰がいつアイテムを追加・更新・削除したかの履歴を記録しなければならない
- **FR-023**: システムはオフライン同期時の競合を最新タイムスタンプ優先(Last Write Wins)で解決し、上書きされたユーザーに通知を表示しなければならない

### Key Entities

- **在庫アイテム (Inventory Item)**: 家庭で管理する食材や日用品を表す。属性: アイテム名、数量、単位、消費期限、カテゴリ、保管場所、画像URL、メモ、使い切り状態フラグ(数量0の場合true)、作成者ユーザーID、登録日時、最終更新日時、最終更新者ユーザーID。アイテムの一意性は(世帯ID + アイテム名 + 消費期限)の組み合わせで判定される
- **ユーザー (User)**: システムを利用する個人。属性: ユーザーID、表示名、メールアドレス、所属世帯ID(任意)、登録日時
- **世帯 (Household)**: 在庫を共有するユーザーグループ。属性: 世帯ID、世帯名、作成者ユーザーID、招待コード、作成日時。個人用在庫モードのユーザーは世帯に所属しない
- **カテゴリ (Category)**: アイテムを分類するためのカテゴリ。属性: カテゴリ名、アイコン、並び順。例: 野菜、果物、肉類、魚類、乳製品、調味料、日用品、など
- **保管場所 (Storage Location)**: アイテムの保管場所を表す。属性: 場所名。例: 冷蔵庫、冷凍庫、パントリー、棚、など

### Assumptions

- ユーザー認証はメールアドレスとパスワードによる標準的な認証方式を採用する(将来的にはOAuth2も検討)
- 在庫データは無期限で保持される(ユーザーが明示的に削除するまで残る)
- 画像アップロードは任意機能とし、必須ではない
- カテゴリと保管場所は事前定義された選択肢から選ぶ方式とする(カスタムカテゴリの追加は将来拡張として検討)
- 世帯共有モードでは、世帯メンバー全員が同等の権限を持つ(管理者・一般ユーザーの区別なし)
- オフライン対応はモバイルアプリ(iOS/Android)のみとし、WebとCLIは常時オンライン前提とする
- 消費期限の近いアイテムの基準は「3日以内」をデフォルトとする(将来的にはユーザー設定可能にする)
- 同時編集の競合は「最後の書き込みが優先(Last Write Wins)」方式とし、上書きされたユーザーには通知で知らせる
- 在庫アイテムの並び順はデフォルトで「登録日時の降順」とする

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: ユーザーは新しい在庫アイテムを30秒以内に登録できる
- **SC-002**: システムは500件の在庫アイテムを2秒以内に一覧表示できる
- **SC-003**: ユーザーの90%以上が最初の試行でアイテムの追加・更新・削除を成功させる
- **SC-004**: 各プラットフォーム(iOS/Android/Web/CLI)で追加されたデータが、他のプラットフォームで5秒以内に同期される
- **SC-005**: オフライン時に行った操作が、オンライン復帰後30秒以内に同期される
- **SC-006**: ユーザーの80%以上が「在庫管理が以前より簡単になった」と評価する
- **SC-007**: 検索・フィルタリング機能により、ユーザーが目的のアイテムを10秒以内に見つけられる
- **SC-008**: システムは100人の同時ユーザーをサポートできる(初期目標)
