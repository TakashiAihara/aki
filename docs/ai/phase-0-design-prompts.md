# Phase 0: 設計フェーズ用プロンプト集

Phase 0（思考・設計フェーズ）で使用するプロンプトテンプレート集です。

**対象ツール**: Claude Code

---

## 目次

1. [要件整理](#1-要件整理)
2. [ドメイン分割](#2-ドメイン分割)
3. [レイヤ設計](#3-レイヤ設計)
4. [ADR 作成](#4-adr-作成)
5. [データモデル定義](#5-データモデル定義)

---

## 1. 要件整理

### テンプレート

```markdown
【目的】
[実現したい機能・ビジネス価値]

【ユーザーストーリー】
- ユーザーは [誰] として
- [何をしたい]
- なぜなら [理由]

【機能要件】
- [必須機能1]
- [必須機能2]

【非機能要件】
- パフォーマンス: [目標値]
- セキュリティ: [要求事項]
- 可用性: [要求事項]

【制約条件】
- [技術的制約]
- [ビジネス的制約]

【スコープ外】
- [今回やらないこと]

【出力】
要件を整理し、曖昧な点があれば質問してください。
その後、要件仕様書としてまとめてください。
```

---

### 実例

```markdown
【目的】
ユーザーが自分のプロフィールを管理できる機能を実装したい

【ユーザーストーリー】
- ユーザーは 登録済みユーザー として
- 自分のプロフィール（名前、メール、プロフィール画像）を編集したい
- なぜなら 情報を最新に保ちたいから

【機能要件】
- プロフィール情報の表示
- プロフィール情報の編集（名前、メール、画像）
- メールアドレス変更時の確認メール送信

【非機能要件】
- パフォーマンス: 画像アップロードは3秒以内
- セキュリティ: メール変更は確認必須
- 可用性: 99.9%

【制約条件】
- 画像は最大5MBまで
- 対応フォーマット: JPG, PNG, WebP

【スコープ外】
- パスワード変更（別機能で対応）
- アカウント削除（別機能で対応）

【出力】
要件を整理し、曖昧な点があれば質問してください。
その後、要件仕様書としてまとめてください。
```

---

## 2. ドメイン分割

### テンプレート

```markdown
【システム概要】
[システム全体の説明]

【主要な概念・エンティティ】
- [概念1]: [説明]
- [概念2]: [説明]

【検討したいこと】
このシステムをどのようにドメインで分割すべきか、以下の観点で検討してください:
- 境界付けられたコンテキスト（Bounded Context）
- 凝集度の高さ
- 結合度の低さ
- 将来の変更容易性

【制約】
- YAGNI 原則
- 過剰な分割はしない
- 最小構成から始める

【出力】
1. 推奨ドメイン分割案（2-3案）
2. 各案の長所・短所
3. 推奨案とその理由
```

---

### 実例

```markdown
【システム概要】
ECサイトの注文管理システム

【主要な概念・エンティティ】
- ユーザー: 購入者
- 商品: 販売する商品
- 注文: 購入の記録
- 在庫: 商品の在庫管理
- 決済: 支払い処理
- 配送: 商品の配送

【検討したいこと】
このシステムをどのようにドメインで分割すべきか、以下の観点で検討してください:
- 境界付けられたコンテキスト（Bounded Context）
- 凝集度の高さ
- 結合度の低さ
- 将来の変更容易性

【制約】
- YAGNI 原則
- 過剰な分割はしない
- 最小構成から始める（マイクロサービスは不要）

【出力】
1. 推奨ドメイン分割案（2-3案）
2. 各案の長所・短所
3. 推奨案とその理由
```

---

## 3. レイヤ設計

### テンプレート

```markdown
【システム】
[システム名・概要]

【技術スタック】
- 言語: [言語]
- フレームワーク: [フレームワーク]
- データベース: [DB]

【検討したいこと】
このシステムのレイヤ構成を決めたい。以下の選択肢を比較してください:
- 3層アーキテクチャ（Controller / Service / Repository）
- レイヤードアーキテクチャ（Presentation / Application / Domain / Infrastructure）
- クリーンアーキテクチャ
- その他推奨案

【評価観点】
- シンプルさ
- 将来の拡張性（ただしYAGNI原則も考慮）
- チームの習熟度
- テスタビリティ

【制約】
- 過剰な抽象化は避ける
- 最小構成から始める

【出力】
1. 各アーキテクチャの長所・短所
2. 推奨案とその理由
3. 簡単な構成図
4. ADR 形式で出力
```

---

### 実例

```markdown
【システム】
ユーザー管理・認証システム（Node.js / Express）

【技術スタック】
- 言語: TypeScript
- フレームワーク: Express
- データベース: PostgreSQL
- ORM: Prisma

【検討したいこと】
このシステムのレイヤ構成を決めたい。以下の選択肢を比較してください:
- 3層アーキテクチャ（Controller / Service / Repository）
- レイヤードアーキテクチャ（Presentation / Application / Domain / Infrastructure）
- クリーンアーキテクチャ
- その他推奨案

【評価観点】
- シンプルさ（最重要）
- 将来の拡張性（ただしYAGNI原則も考慮）
- チームの習熟度（Express経験あり、DDD経験なし）
- テスタビリティ

【制約】
- 過剰な抽象化は避ける
- 最小構成から始める
- チームは DDD 未経験

【出力】
1. 各アーキテクチャの長所・短所
2. 推奨案とその理由
3. 簡単な構成図
4. ADR 形式で出力
```

---

## 4. ADR 作成

### テンプレート

```markdown
【決定事項】
[何を決定するか]

【背景】
[なぜこの決定が必要か]

【検討した選択肢】
1. [選択肢1]
2. [選択肢2]
3. [選択肢3]

【評価観点】
- [観点1]
- [観点2]
- [観点3]

【出力】
ADR-NNNN 形式で、以下を含む ADR を作成してください:
- 各選択肢の長所・短所
- トレードオフの明示
- 推奨案とその理由
- 将来のリスク

テンプレート: docs/adr/template.md
```

---

### 実例

```markdown
【決定事項】
認証方式を JWT にするか、セッションにするかを決定したい

【背景】
ユーザー認証機能を実装する必要がある。
現状、フロントエンドは React SPA、バックエンドは Express API。

【検討した選択肢】
1. JWT（JSON Web Token）
2. セッション（Cookie-based）
3. OAuth 2.0 / OpenID Connect

【評価観点】
- セキュリティ
- スケーラビリティ
- 実装コスト
- ユーザー体験（ログアウト、トークン無効化）

【制約】
- チームは認証の実装経験が少ない
- セキュリティは最優先
- スケーラビリティは現時点で不要（ユーザー数 < 1,000）

【出力】
ADR-0003 形式で、以下を含む ADR を作成してください:
- 各選択肢の長所・短所
- トレードオフの明示
- 推奨案とその理由
- 将来のリスク

テンプレート: docs/adr/template.md
```

---

## 5. データモデル定義

### テンプレート

```markdown
【ドメイン】
[対象ドメイン]

【主要エンティティ】
- [エンティティ1]: [説明]
- [エンティティ2]: [説明]

【リレーションシップ】
- [エンティティ1] と [エンティティ2] の関係: [1:N / N:M / 1:1]

【検討したいこと】
データモデルを設計したい。以下を含めてください:
- 主要エンティティの定義
- フィールド一覧（型、制約）
- リレーションシップ
- インデックス戦略

【制約】
- YAGNI 原則（使わないフィールドは追加しない）
- 正規化は第3正規形まで
- パフォーマンスが重要なクエリは非正規化を検討

【出力】
1. ER図（Mermaid形式）
2. 各エンティティの DDL（CREATE TABLE）
3. リレーションシップの説明
```

---

### 実例

```markdown
【ドメイン】
ブログシステム

【主要エンティティ】
- User: ブログの著者
- Post: ブログ記事
- Comment: 記事へのコメント
- Tag: 記事のタグ

【リレーションシップ】
- User と Post: 1:N（1人のユーザーが複数の記事を投稿）
- Post と Comment: 1:N（1つの記事に複数のコメント）
- Post と Tag: N:M（記事は複数のタグを持ち、タグは複数の記事に紐づく）

【検討したいこと】
データモデルを設計したい。以下を含めてください:
- 主要エンティティの定義
- フィールド一覧（型、制約）
- リレーションシップ
- インデックス戦略

【制約】
- YAGNI 原則（いいね機能、下書き機能は今回不要）
- 正規化は第3正規形まで
- 記事一覧の取得が最も頻繁なクエリ

【出力】
1. ER図（Mermaid形式）
2. 各エンティティの DDL（CREATE TABLE）
3. リレーションシップの説明
4. インデックス戦略
```

---

## プロンプト活用の流れ

### ステップ1: 要件整理

```
テンプレートをコピー → Claude Code に貼り付け → 対話しながら要件を明確化
```

### ステップ2: ドメイン分割 / レイヤ設計

```
要件をもとに → テンプレートを使って設計検討 → 複数案を比較
```

### ステップ3: ADR 作成

```
設計決定を → ADR テンプレートで記録 → docs/adr/ に保存
```

### ステップ4: データモデル定義

```
設計をもとに → ER図 + DDL を生成 → レビュー
```

---

## Tips

### 1. 段階的に詳細化する

最初は大まかに、徐々に詳細化していきます。

```
粗い要件 → 詳細要件 → ドメイン分割 → レイヤ設計 → データモデル
```

### 2. 「なぜ?」を繰り返す

Claude は理由を説明するのが得意です。

```markdown
「なぜこの設計を選んだのですか？」
「他の選択肢と比較してどこが優れていますか？」
「この決定によるリスクは何ですか？」
```

### 3. 制約を明示する

YAGNI 原則を毎回明示します。

```markdown
「制約: YAGNI、最小構成、将来拡張は考えない」
```

---

*最終更新: 2025年1月*
